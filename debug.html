<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug - Royal Enfield Bike Price Predictor</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .debug-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
        }
        .debug-info h3 {
            margin-top: 0;
            color: #495057;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .warning {
            color: #ffc107;
            font-weight: bold;
        }
        .model-test {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .model-test.pass {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
        }
        .model-test.fail {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
        }
        .model-test.warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <header>
            <div class="logo">
                <i class="fas fa-motorcycle"></i>
                <h1>Royal Enfield Debug</h1>
            </div>
            <p class="tagline">Debugging tool for Royal Enfield Price Predictor</p>
        </header>

        <!-- Debug Section -->
        <main>
            <div class="content-wrapper">
                <section class="input-section">
                    <div class="card">
                        <h2><i class="fas fa-bug"></i> Debug Information</h2>
                        
                        <div class="debug-info">
                            <h3>System Status</h3>
                            <div id="systemStatus">Checking...</div>
                        </div>
                        
                        <div class="debug-info">
                            <h3>Model Data Status</h3>
                            <div id="modelDataStatus">Checking...</div>
                        </div>
                        
                        <div class="debug-info">
                            <h3>Test All Models</h3>
                            <button id="testAllModels">Test All Models</button>
                            <div id="testResults"></div>
                        </div>
                        
                        <div class="debug-info">
                            <h3>Manual Test</h3>
                            <div class="form-group">
                                <label for="testModel">Select Model to Test:</label>
                                <select id="testModel">
                                    <option value="">Select Model</option>
                                    <option value="Classic 350">Classic 350</option>
                                    <option value="Bullet 350">Bullet 350</option>
                                    <option value="Himalayan">Himalayan</option>
                                    <option value="Meteor 350">Meteor 350</option>
                                    <option value="Hunter 350">Hunter 350</option>
                                    <option value="Continental GT 650">Continental GT 650</option>
                                    <option value="INT 650">INT 650</option>
                                    <option value="Scram 411">Scram 411</option>
                                    <option value="Guerrilla 450">Guerrilla 450</option>
                                    <option value="Himalayan 450">Himalayan 450</option>
                                    <option value="Super Meteor 650">Super Meteor 650</option>
                                    <option value="Bullet 650">Bullet 650</option>
                                    <option value="Goan Classic 350">Goan Classic 350</option>
                                    <option value="Bear 650">Bear 650</option>
                                    <option value="Shotgun 650">Shotgun 650</option>
                                    <option value="Scrambler 450">Scrambler 450</option>
                                    <option value="Himalayan 750">Himalayan 750</option>
                                    <option value="Flying Flea">Flying Flea</option>
                                    <option value="Interceptor 650">Interceptor 650</option>
                                </select>
                            </div>
                            <button id="testSelectedModel">Test Selected Model</button>
                            <div id="manualTestResult"></div>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Global variable to store model data
        let modelData = null;
        
        // Model information with pros and cons
        const bikeInfo = {
            "Classic 350": {
                pros: ["Timeless design", "Great build quality", "Comfortable for long rides", "Good resale value"],
                cons: ["Heavy weight", "Less powerful compared to newer models", "Basic features"]
            },
            "Bullet 350": {
                pros: ["Iconic design", "Very comfortable seating", "Excellent build quality", "Unique thump sound"],
                cons: ["Heavy and difficult to maneuver", "Low power output", "High maintenance cost"]
            },
            "Himalayan": {
                pros: ["Adventure touring capability", "Upright riding position", "Good ground clearance", "Affordable adventure bike"],
                cons: ["Less powerful engine", "Basic features", "Not ideal for highway cruising"]
            },
            "Meteor 350": {
                pros: ["Modern cruiser design", "Powerful engine", "Comfortable for city and highway", "Good features"],
                cons: ["Higher price point", "Less luggage space", "Not suitable for off-roading"]
            },
            "Hunter 350": {
                pros: ["Retro cafe racer design", "Lightweight and agile", "Fuel efficient", "Affordable price"],
                cons: ["Less comfortable for long rides", "Limited touring capability", "Basic instrumentation"]
            },
            "Continental GT 650": {
                pros: ["Premium cafe racer design", "Powerful 650cc engine", "Excellent performance", "High-quality components"],
                cons: ["Higher price point", "Less practical for daily commuting", "Requires more maintenance"]
            },
            "INT 650": {
                pros: ["Versatile design", "Strong 650cc engine", "Good for both city and touring", "Modern features"],
                cons: ["Higher cost than 350cc models", "More complex maintenance", "Heavier than 350cc bikes"]
            },
            "Scram 411": {
                pros: ["Adventure styling", "Good ground clearance", "Lightweight", "Fuel efficient"],
                cons: ["Less powerful engine", "Limited luggage capacity", "Basic features"]
            },
            "Guerrilla 450": {
                pros: ["Adventure touring focus", "Modern engine technology", "Good performance", "Advanced features"],
                cons: ["Higher price", "More complex maintenance", "Less proven track record"]
            },
            "Himalayan 450": {
                pros: ["Upgraded adventure bike", "More powerful engine", "Improved performance", "Modern features"],
                cons: ["Higher cost", "More maintenance requirements", "Heavier than previous model"]
            },
            "Super Meteor 650": {
                pros: ["Powerful 650cc engine", "Modern cruiser design", "Excellent performance", "Premium components"],
                cons: ["Higher price point", "Heavier weight", "More complex maintenance"]
            },
            "Bullet 650": {
                pros: ["Iconic design with modern engine", "Powerful 650cc motor", "Improved performance", "Classic aesthetics"],
                cons: ["Higher cost than 350cc Bullet", "Heavier weight", "More maintenance required"]
            },
            "Goan Classic 350": {
                pros: ["Unique styling", "Classic design with modern touches", "Good build quality", "Distinctive appearance"],
                cons: ["Limited availability", "Specialized market", "May have lower resale value"]
            },
            "Bear 650": {
                pros: ["Powerful 650cc engine", "Sturdy build", "Good for touring", "Premium components"],
                cons: ["Higher price", "Heavy weight", "More complex maintenance"]
            },
            "Shotgun 650": {
                pros: ["Unique styling", "Powerful engine", "Distinctive design", "Premium features"],
                cons: ["Niche appeal", "Higher cost", "Specialized maintenance"]
            },
            "Scrambler 450": {
                pros: ["Adventure styling", "Modern engine", "Good ground clearance", "Versatile design"],
                cons: ["Less powerful than 650cc models", "Limited luggage space", "Specialized market"]
            },
            "Himalayan 750": {
                pros: ["Most powerful Royal Enfield engine", "Excellent performance", "Advanced features", "Premium build"],
                cons: ["Highest price point", "Most complex maintenance", "Heaviest model"]
            },
            "Flying Flea": {
                pros: ["Unique compact design", "Lightweight", "Fuel efficient", "Distinctive styling"],
                cons: ["Limited power", "Very specialized use", "Niche market appeal"]
            },
            "Interceptor 650": {
                pros: ["Classic retro design", "Powerful 650cc engine", "Good performance", "Premium components"],
                cons: ["Higher price", "More maintenance", "Heavier than 350cc models"]
            }
        };

        // Load model data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
            loadModelData();
        });

        // Check system status
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            
            try {
                // Check if model_data.json exists
                const response = await fetch('model_data.json');
                if (response.ok) {
                    statusDiv.innerHTML = '<span class="success">✓ model_data.json file found</span>';
                } else {
                    statusDiv.innerHTML = '<span class="error">✗ model_data.json file not found</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = '<span class="error">✗ Error accessing model_data.json: ' + error.message + '</span>';
            }
        }

        // Load model data from JSON file
        async function loadModelData() {
            const statusDiv = document.getElementById('modelDataStatus');
            
            try {
                const response = await fetch('model_data.json');
                modelData = await response.json();
                statusDiv.innerHTML = '<span class="success">✓ Model data loaded successfully</span>';
                statusDiv.innerHTML += '<br>Available models in mapping: ' + Object.keys(modelData.mappings.model_mapping).length;
                statusDiv.innerHTML += '<br>Supported models in metadata: ' + modelData.metadata.supported_models.length;
            } catch (error) {
                statusDiv.innerHTML = '<span class="error">✗ Error loading model data: ' + error.message + '</span>';
                modelData = null;
            }
        }

        // Test all models
        document.getElementById('testAllModels').addEventListener('click', function() {
            testAllModels();
        });

        // Test selected model
        document.getElementById('testSelectedModel').addEventListener('click', function() {
            const model = document.getElementById('testModel').value;
            if (!model) {
                document.getElementById('manualTestResult').innerHTML = '<div class="model-test fail">Please select a model to test</div>';
                return;
            }
            testModel(model);
        });

        // Test all models
        async function testAllModels() {
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>Testing all models...</p>';
            
            // List of all models
            const allModels = [
                "Classic 350", "Bullet 350", "Himalayan", "Meteor 350", "Hunter 350",
                "Continental GT 650", "INT 650", "Scram 411", "Guerrilla 450", "Himalayan 450",
                "Super Meteor 650", "Bullet 650", "Goan Classic 350", "Bear 650", "Shotgun 650",
                "Scrambler 450", "Himalayan 750", "Flying Flea", "Interceptor 650"
            ];
            
            let passCount = 0;
            let failCount = 0;
            
            resultsDiv.innerHTML = '';
            
            for (const model of allModels) {
                const result = await testModel(model, false); // Don't display individual results yet
                const modelDiv = document.createElement('div');
                
                if (result.success) {
                    modelDiv.className = 'model-test pass';
                    modelDiv.innerHTML = `<strong>${model}</strong>: <span class="success">PASS</span> - ${result.message}`;
                    passCount++;
                } else {
                    modelDiv.className = 'model-test fail';
                    modelDiv.innerHTML = `<strong>${model}</strong>: <span class="error">FAIL</span> - ${result.message}`;
                    failCount++;
                }
                
                resultsDiv.appendChild(modelDiv);
            }
            
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'debug-info';
            summaryDiv.innerHTML = `<h3>Test Summary</h3>
                                   <p>Total Models: ${allModels.length}</p>
                                   <p class="success">Passed: ${passCount}</p>
                                   <p class="error">Failed: ${failCount}</p>`;
            
            resultsDiv.appendChild(summaryDiv);
        }

        // Test a single model
        async function testModel(model, displayResult = true) {
            const resultDiv = document.getElementById('manualTestResult');
            
            try {
                // Check if model exists in bikeInfo
                const hasBikeInfo = bikeInfo.hasOwnProperty(model);
                
                // Check if model exists in modelData mappings
                let hasModelMapping = false;
                let hasModelData = false;
                
                if (modelData && modelData.mappings && modelData.mappings.model_mapping) {
                    hasModelMapping = modelData.mappings.model_mapping.hasOwnProperty(model);
                }
                
                // Perform a sample prediction
                let predictionSuccess = false;
                let predictionValue = 0;
                
                try {
                    // Sample prediction with dummy values
                    const bikeAge = 2;
                    const kmsDriven = 10000;
                    const presentPrice = 2.0;
                    const owner = "First";
                    const transmission = "Manual";
                    
                    predictionValue = predictPriceWithModel(model, bikeAge, kmsDriven, presentPrice, owner, transmission);
                    predictionSuccess = true;
                } catch (predictionError) {
                    console.error('Prediction error for model ' + model + ':', predictionError);
                }
                
                const result = {
                    success: hasBikeInfo && hasModelMapping && predictionSuccess,
                    message: ''
                };
                
                if (!hasBikeInfo) {
                    result.message += 'No bike info found. ';
                }
                
                if (!hasModelMapping) {
                    result.message += 'No model mapping found. ';
                }
                
                if (!predictionSuccess) {
                    result.message += 'Prediction failed. ';
                } else {
                    result.message += 'Prediction successful: ₹' + predictionValue.toFixed(2) + ' Lakhs. ';
                }
                
                if (result.success) {
                    result.message = 'All checks passed. ' + result.message;
                }
                
                if (displayResult) {
                    const modelDiv = document.createElement('div');
                    modelDiv.className = result.success ? 'model-test pass' : 'model-test fail';
                    modelDiv.innerHTML = `<strong>${model}</strong>: ${result.success ? '<span class="success">PASS</span>' : '<span class="error">FAIL</span>'} - ${result.message}`;
                    resultDiv.innerHTML = '';
                    resultDiv.appendChild(modelDiv);
                }
                
                return result;
            } catch (error) {
                const result = {
                    success: false,
                    message: 'Error during testing: ' + error.message
                };
                
                if (displayResult) {
                    const modelDiv = document.createElement('div');
                    modelDiv.className = 'model-test fail';
                    modelDiv.innerHTML = `<strong>${model}</strong>: <span class="error">ERROR</span> - ${result.message}`;
                    resultDiv.innerHTML = '';
                    resultDiv.appendChild(modelDiv);
                }
                
                return result;
            }
        }

        // Predict price using the trained model
        function predictPriceWithModel(model, bikeAge, kmsDriven, presentPrice, owner, transmission) {
            try {
                // Check if model exists in mappings
                if (!modelData.mappings.model_mapping.hasOwnProperty(model)) {
                    throw new Error('Model not found in mappings: ' + model);
                }
                
                // Encode categorical variables
                const modelEncoded = modelData.mappings.model_mapping[model];
                const ownerEncoded = modelData.mappings.owner_mapping[owner] || 0;
                const transmissionEncoded = modelData.mappings.transmission_mapping[transmission] || 0;
                
                // Create feature array
                const features = [
                    modelEncoded,
                    bikeAge,
                    kmsDriven,
                    ownerEncoded,
                    transmissionEncoded,
                    presentPrice
                ];
                
                // Calculate prediction using linear regression formula: y = intercept + coef * features
                let prediction = modelData.model.intercept;
                for (let i = 0; i < modelData.model.coef.length; i++) {
                    prediction += modelData.model.coef[i] * features[i];
                }
                
                // Ensure prediction is reasonable
                if (prediction < 0) {
                    throw new Error('Negative prediction value');
                }
                
                return prediction;
            } catch (error) {
                throw new Error('Model prediction failed: ' + error.message);
            }
        }
    </script>
</body>
</html>